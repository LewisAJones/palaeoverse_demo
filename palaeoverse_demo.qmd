---
title: | 
  Into the palaeoverse
subtitle: |
  A community-driven R package
  
  [<img src="/images/logo.png" height="150"/>](/images/logo.png)
author: | 
  [Lewis A. Jones ](mailto:LewisAlan.Jones@uvigo.es), Universidade de Vigo
  
  [<img src="/images/mapas.png" height="80"/>](/images/mapas.png)
  [<img src="/images/erc.png" height="80"/>](/images/erc.png)
affiliation: "Universidade de Vigo"
execute:
  echo: true
  eval: true
format: 
  revealjs:
    logo: "/images/logo.png"
    footer: "[palaeoverse: a community-driven R package](https://palaeoverse.org)"
    theme: default
---

## Development team {.smaller}

::: columns
::: {.column width="50%"}
-   [Lewis A. Jones](mailto:LewisAlan.Jones@uvigo.es), Universidade de Vigo
-   [William Gearty](mailto:willgearty@gmail.com), American Museum of Natural History
-   [Bethany J. Allen](mailto:Bethany.Allen@bsse.ethz.ch), ETH Z√ºrich
-   [Kilian Eichenseer](mailto:kilian.eichenseer@gmail.com), Durham University
-   [Christopher D. Dean](christopherdaviddean@gmail.com), University College London
-   [Sof√≠a Galv√°n](mailto:sofia.galvan@uvigo.es), Universidade de Vigo
-   [Miranta Kouvari](mailto:kouvari.miranta@gmail.com), University College London/Natural History Museum
:::

::: {.column width="50%"}
-   [Pedro L. Godoy](mailto:pedrolorenagodoy@gmail.com), University of S√£o Paulo/Stony Brook University
-   [Cecily Nicholl](cecily.nicholl@ucl.ac.uk), University College London
-   [Lucas Buffan](mailto:lucas.buffan@ens-lyon.fr), √âcole Normale Sup√©rieure de Lyon
-   [Erin M. Dillon](mailto:erinmdillon@ucsb.edu), Smithsonian Tropical Research Institute/University of California
-   [Alfio A. Chiarenza](mailto:a.chiarenza15@gmail.com), Universidade de Vigo
:::
:::

## Funders {.smaller}

-   European Union's Horizon 2020 research and innovation program (MAPAS project)
    -   Grant number: 947921
-   The Royal Society
    -   Grant numbers: RF_ERE_210013, RGF_R1_180020, and RGF_EA_180318
-   Juan de la Cierva-formaci√≥n fellowship
    -   FJC2020-044836-I / MCIN /AEI / 10.13039 /501100011033
-   ETH+ Research Grant (BECCY project)
-   FAPESP Postdoctoral fellowship
    -   Grant number: 2022/05697-9
-   Population Biology Program of Excellence Postdoctoral Fellowship (the University of Nebraska-Lincoln)
-   Lerner-Gray Postdoctoral Research Fellowship (American Museum of Natural History)

# Introduction

*The long and the short of it* üìè*...*

## What is Palaeoverse?

<center>

*Palaeoverse is a project that aims to **bring the palaeobiology community together.***

[<img src="/images/hands.png" height="120"/>](/images/hands.png)

</center>

-   **Twitter**: News and updates
    -   [\@ThePalaeoverse](https://twitter.com/ThePalaeoverse)
-   **Google Group**: A community space
    -   <https://groups.google.com/g/palaeoverse>

## What is the palaeoverse R package?

<center>

[<img src="/images/claddis.jpeg" height="150"/>](/images/claddis.jpeg) [<img src="/images/divdyn.png" height="150"/>](/images/divdyn.png)

**palaeoverse** provides auxiliary functions to support data preparation and exploration.

[<img src="/images/logo.png" height="150"/>](/images/logo.png)

*Improve code readability, reusability and reproducibility.*

</center>

## What makes palaeoverse different?

![](images/another-r-package.jpg){.absolute top="120" right="0" width="250" height="300"}

::: columns
::: {.column width="75%"}
-   **Community-informed development**
    -   Authors (*n* = 13)
    -   Survey participants (*n* = 35)
-   **Well-documented & peer-reviewed code**
    -   Formal review process
:::

::: {.column width="25%"}
:::
:::

<br>

<center>

### A community-driven package

</center>

## What makes palaeoverse different?

![](images/chris-pratt.jpg){.absolute top="120" right="0" width="250" height="175"}

::: columns
::: {.column width="75%"}
-   **Community-informed development**
    -   Authors (*n* = 13)
    -   Survey participants (*n* = 35)
-   **Well-documented & peer-reviewed code**
    -   Formal review process
:::

::: {.column width="25%"}
:::
:::

<br>

<center>

### A community-driven package

</center>

# Functionality

*A whistle-stop tour of palaeoverse* üöã*...*

## What's available? {.smaller}

::: columns
::: {.column width="50%"}
-   `axis_geo`
-   `bin_lat`
-   `bin_time`
-   `data`
-   `group_apply`
-   `lat_bins`
-   `look_up`
-   `palaeorotate`
:::

::: {.column width="50%"}
-   `phylo_check`
-   `tax_check`
-   `tax_expand_lat`
-   `tax_expand_time`
-   `tax_range_space`
-   `tax_range_time`
-   `tax_unique`
-   `time_bins`
:::
:::

## Expected input

A lot of data, a lot of sources, and a lot of unique problems.

![](images/gbdb.png){.absolute top="150" left="0" width="150" height="150"} ![](images/pbdb.png){.absolute top="150" left="200" width="150" height="150"} ![](images/pared.png){.absolute top="150" left="400" width="220" height="150"} ![](images/neotoma.png){.absolute top="150" left="630" width="200" height="150"} ![](images/neptune.png){.absolute top="150" left="850" width="200" height="150"} <br> <br> <br> <br>

<center>

**Data structure, not source.**

`occdf` $\rightarrow$ `function(x)` $\rightarrow$ `df`

Occurrence dataframe\*

</center>

::: aside
\*Exceptions do exist.
:::

# Getting started

*Let's dive in ü§ø...*

## Installation

<br> **palaeoverse** can be installed from the CRAN using:

```{r, eval = FALSE}
install.packages("palaeoverse")
```

<br> The development version can be installed using devtools:

```{r, eval = FALSE}
devtools::install_github("palaeoverse-community/palaeoverse")
```

<br> Once installed, load the package in the usual manner:

```{r}
library(palaeoverse)
```

## Example datasets

Two example occurrence datasets are available.

Carboniferous--Early Triassic tetrapods (*n* = 5270, [Paleobiology Database](https://paleobiodb.org/#/)).

```{r}
# Get details on dataset
?tetrapods
# Load dataset
data("tetrapods")
```

Phanerozoic reef occurrences (*n* = 4363, [PaleoReefs Database](https://www.paleo-reefs.pal.uni-erlangen.de)).

```{r}
# Get details on dataset
?reefs
# Load dataset
data("reefs")
```

## Reference datasets { .smaller}

Two reference datasets are available.

Geological Time Scale 2012 & 2020 (Gradstein et al. 2012, 2020).

```{r}
# Get details on dataset
?GTS2012
?GTS2020
# Load dataset
data("GTS2012")
data("GTS2020")
head(GTS2012)
head(GTS2020)
```

## Stratigraphic time bins { .smaller}

```{r}
# Get stage-level time bins
bins <- time_bins(interval = "Phanerozoic", rank = "stage", plot = TRUE)
```

```{r}
# Get first few rows
head(bins, n = 3)
```

## Near-equal-length time bins { .smaller}

```{r}
# Get stage-level time bins
bins <- time_bins(interval = "Phanerozoic", rank = "stage", size = 15, plot = TRUE)
```

```{r}
# Get first few rows
head(bins)
```

## Occurrence binning (time) { .smaller}

Five temporal binning methods for age range data:

```{r}
# Use tetrapod example data
occdf <- tetrapods
# Get stage-level time bins
bins <- time_bins(interval = "Phanerozoic", rank = "stage")
# Assign via midpoint age of fossil occurrence data
ex1 <- bin_time(occdf = occdf, bins = bins, method = "mid")
# Assign to all bins that age range covers
ex2 <- bin_time(occdf = occdf, bins = bins, method = "all")
# Assign via majority overlap based on fossil occurrence age range
ex3 <- bin_time(occdf = occdf, bins = bins, method = "majority")
# Randomly assign to overlapping bins based on fossil occurrence age range
ex4 <- bin_time(occdf = occdf, bins = bins, method = "random", reps = 10)
# Randomly assign point estimates (uniform distribution) based on fossil occurrence age range
ex5 <- bin_time(occdf = occdf, bins = bins, method = "point", reps = 10)
```

## Occurrence binning (latitude) { .smaller}

Generate and bin latitudinal data:

```{r}
# Generate latitudinal bins
bins <- lat_bins(size = 10, plot = TRUE)
```

```{r}
# Use reef example data
occdf <- reefs
# Bin occurrences
occdf <- bin_lat(occdf = occdf, bins = bins, lat = "lat")
```

## Occurrence binning (space) { .smaller}

Generate and bin spatial data:

```{r}
# Reduce data for plotting
occdf <- reefs[1:500, ]
# Bin data using a hexagonal equal-area grid
occdf <- bin_space(occdf = occdf, spacing = 250, plot = TRUE)
```

## Palaeogeographic reconstruction { .smaller}

Palaeorotate fossil occurrences (eight models available):

```{r, eval = FALSE}
# Example with a few occurrences
occdf <- data.frame(lng = c(2, -103, -66),
                    lat = c(46, 35, -7),
                    age = c(88, 125, 200))
# Estimate palaeocoordinates using the GPlates API
ex1 <- palaeorotate(occdf = occdf, method = "point")
# Estimate palaeocoordinates using reconstruction files
ex2 <- palaeorotate(occdf = occdf, method = "grid")
# Estimate palaeocoordinates and uncertainty using reconstruction files
ex3 <- palaeorotate(occdf = occdf, method = "grid", uncertainty = TRUE)
ex3
```

## Taxon-related features { .smaller}

Taxonomic spell check:

```{r}
# load occurrence data
data("tetrapods")
# Check taxon names alphabetically
ex1 <- tax_check(taxdf = tetrapods, name = "genus", dis = 0.05, verbose = FALSE)
# Get first few rows
head(ex1)
```


```{r}
# Check taxon names by group
ex2 <- tax_check(taxdf = tetrapods, name = "genus", group = "family", dis = 0.05, verbose = FALSE)
# Get first few rows
head(ex2)
```

In this example dataset:
- Dinosaurus belongs to the Phthinosuchidae
- Dvinosaurus belongs to the Dvinosauridae
- Varanops belongs to the Varanopidae
- Varanopus belongs to the Captorhinidae

## Taxon-related features { .smaller}

Identifying unique taxa:

```{r}
# Create dataframe
occdf <- data.frame(species = c("rex", "aegyptiacus", NA),
                    genus = c("Tyrannosaurus", "Spinosaurus", NA),
                    family = c("Tyrannosauridae", "Spinosauridae", "Diplodocidae"))
# Retain unique taxa
dinosaur_species <- tax_unique(occdf = occdf,
                               species = "species",
                               genus = "genus",
                               family = "family",
                               resolution = "species")
head(occdf)
```

## Taxon-related features { .smaller}

Temporal range of taxa:

```{r}
# Grab tetrapod data
occdf <- tetrapods
# Remove NAs
occdf <- subset(occdf, !is.na(order))
# Temporal range
ex <- tax_range_time(occdf = occdf, name = "order", plot = TRUE)
```

## Taxon-related features { .smaller}

Geographic range of taxa:

```{r}
# Grab internal data
occdf <- tetrapods
# Remove NAs
occdf <- subset(occdf, !is.na(genus))
# Convex hull
ex1 <- tax_range_space(occdf = occdf, name = "genus", method = "con")
# Latitudinal range
ex2 <- tax_range_space(occdf = occdf, name = "genus", method = "lat")
# Great Circle Distance
ex3 <- tax_range_space(occdf = occdf, name = "genus", method = "gcd")
# Occupied grid cells
ex4 <- tax_range_space(occdf = occdf, name = "genus", method = "occ", spacing = 250)
```

## Phylogeny wrangling

## Additional features

# What's next?

## More packages...

Probably... but, not right now.

## Palaeobiology Task View

## Shiny App

## Funding

## Thank-you / Merci / Gracias / Danke / Bu√≠ochas / Obrigado / Grazie / ŒïœÖœáŒ±œÅŒπœÉœÑœé
